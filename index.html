<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday fireworks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#EC4899',
                        accent: '#10B981',
                        btnColor: '#6366F1', // 主按钮纯色（柔和的靛蓝色，适配深色背景）
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .firework {
                position: absolute;
                bottom: 0;
                width: 6px;
                height: 6px;
                border-radius: 50%;
                opacity: 0;
                transform: scale(0);
                transition: transform 0.2s ease-out, opacity 0.2s ease-out;
            }
            .particle {
                position: absolute;
                opacity: 0;
                transform-origin: center;
                box-shadow: 0 0 3px 1px currentColor; /* 减小粒子光晕 */
            }
            .particle-dot {
                width: 4px;
                height: 4px;
                border-radius: 50%;
            }
            .particle-line {
                width: 2px;
                height: 18px;
                transform: rotate(0deg);
                background: linear-gradient(to top, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.8));
            }
            .birthday-text {
                position: fixed;
                top: 10%;
                left: 0;
                right: 0;
                text-align: center;
                font-size: clamp(1.5rem, 6vw, 4rem);
                font-weight: bold;
                z-index: 10;
                opacity: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.1rem; /* 添加gap属性进一步控制行间距 */
            }
            .line {
                display: flex;
                justify-content: center;
                margin: 0.2rem 0;
            }
            .letter {
                display: inline-block;
                opacity: 0;
                transform: translateY(20px);
                transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            }
            .explosion-flash {
                position: absolute;
                width: 12px; /* 减小闪光尺寸 */
                height: 12px;
                border-radius: 50%;
                opacity: 0;
                background: white;
                filter: blur(3px); /* 减小模糊程度 */
            }
            .start-btn {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 100;
                padding: 0.6rem 1.6rem; /* 进一步缩小内边距，适配手机 */
                font-size: clamp(0.9rem, 3.5vw, 1.1rem); /* 字体再缩小，手机约0.9rem(14.4px) */
                font-weight: 500; /* 字重降低，更柔和 */
                border-radius: 20px; /* 圆角略微调整，匹配小尺寸按钮 */
                background-color: theme('colors.btnColor'); /* 纯色背景 */
                color: white;
                border: none;
                cursor: pointer;
                box-shadow: 0 0 12px rgba(99, 102, 241, 0.5); /* 阴影同步缩小 */
                transition: all 0.3s ease;
                backdrop-filter: blur(5px);
                white-space: nowrap; /* 防止文字换行 */
                text-align: center;
                min-width: 150px; /* 最小宽度同步缩小 */
                max-width: 70%; /* 最大宽度限制更严格 */
            }
            .start-btn:hover {
                transform: translate(-50%, -50%) scale(1.05);
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.8); /* hover阴影适度增强 */
                background-color: #4F46E5; /* hover时略微加深颜色 */
            }
            .start-btn.fade {
                animation: fadeInOut 1s ease;
            }
            .countdown {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 100;
                font-size: clamp(4rem, 20vw, 12rem);
                font-weight: bold;
                color: white;
                text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 40px rgba(236, 72, 153, 0.6);
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            /* 文案过渡动画 */
            @keyframes fadeInOut {
                0% { opacity: 0.3; transform: translate(-50%, -50%) scale(0.9); }
                50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
                100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            }
            /* 简化后的流星效果 - 仅白色光晕，简洁自然 */
            .meteor {
                position: fixed;
                top: 15%;
                right: 20%;
                width: 100px; /* 适中长度，避免过于夸张 */
                height: 1px; /* 纤细线条，更符合流星质感 */
                /* 纯白光晕渐变：头部高亮 → 尾部渐隐，无多余颜色 */
                background: linear-gradient(90deg, 
                    rgba(255, 255, 255, 1), /* 头部：纯白高亮 */
                    rgba(255, 255, 255, 0.8), /* 中部：稍淡 */
                    rgba(255, 255, 255, 0.5), /* 尾部：淡白 */
                    rgba(255, 255, 255, 0.2)    /* 尾端：完全透明 */
                );
                opacity: 0;
                transform: rotate(-30deg); /* 保持自然飞行角度 */
                /* 简洁白色光晕，无分层，避免黑色错觉 */
                box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8),
                            0 0 15px 3px rgba(255, 255, 255, 0.4);
                z-index: 5;
                border-radius: 50% 0 0 50%; /* 头部圆润，尾部尖锐 */
            }
            .meteor.animate {
                /* 平滑飞行动画，无多余闪烁 */
                animation: meteorSlide 1.5s ease-in-out forwards;
            }
            @keyframes meteorSlide {
                0% { 
                    opacity: 0; 
                    transform: rotate(-30deg) translateX(60px); /* 起始位置靠右 */
                    box-shadow: 0 0 5px 1px rgba(255, 255, 255, 0.5);
                }
                20% { 
                    opacity: 1; /* 快速亮起来 */
                    box-shadow: 0 0 12px 2px rgba(255, 255, 255, 0.9),
                                0 0 18px 3px rgba(255, 255, 255, 0.5);
                }
                70% { 
                    opacity: 1; /* 中间阶段保持稳定亮度 */
                }
                100% { 
                    opacity: 0; 
                    transform: rotate(-30deg) translateX(-150px); /* 飞行至左侧消失 */
                    box-shadow: 0 0 5px 1px rgba(255, 255, 255, 0.2);
                }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-gray-900 to-black min-h-screen overflow-hidden">
    <div id="fireworksContainer" class="fixed inset-0 z-0"></div>
    <div class="birthday-text" id="birthdayText"></div>
    <!-- 流星效果元素 -->
    <div class="meteor" id="meteor"></div>
    <!-- 开始按钮（保持三段话文案不变） -->
    <button class="start-btn" id="startBtn">暮色如墨，浸染天际...</button>
    <!-- 倒计时显示 -->
    <div class="countdown" id="countdown"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 全局状态控制
            let isCelebrating = false;
            let clickCount = 0; // 点击次数计数器
            const btnTexts = [
                "暮色如墨，浸染天际...",  // 初始文案（第0句）
                "抬头一瞥，一道亮光拖着极细的尾迹...",  // 第一次点击后（第1句）- 显示流星
                "你合掌的刹那，愿已随光痕寄向星河..."   // 第二次点击后（第2句）- 无流星
            ]; 
            
            // 烟花管理器类封装
            class FireworkManager {
                constructor(containerId) {
                    this.container = document.getElementById(containerId);
                    this.colors = [
                        '#FFA3BF', '#FFC28F', '#FFFF99', '#A3FFA3', '#A3C2FF',
                        '#C2A3FF', '#FFA3FF', '#FFB3B3', '#FFE5B3', '#E5FFB3',
                        '#B3FFB3', '#B3FFE5', '#B3E5FF', '#B3B3FF', '#E5B3FF'
                    ];
                    this.particlePool = [];
                    this.activeFireworks = 0;
                    this.MAX_FIREWORKS = 4;
                    
                    // 动画参数调整
                    this.animationActive = false;
                    this.audioContext = null;
                    this.ascentSpeedFactor = 1;
                    this.particleLifetimeFactor = 1.5;
                    
                    // 爆炸配置
                    this.explosionConfigs = {
                        ring: { particleCount: 60, radius: 100 },
                        pulse: { particleCount: 60, pulseCount: 2, delay: 300 },
                        star: { points: 12, radius: 120, innerRadius: 50, extraParticles: 30 },
                        heart: { particleCount: 60, scale: 20, speed: 0.25, centerOffset: 30 }
                    };

                    this.init();
                }

                // 初始化
                init() {
                    this.setupEventListeners();
                    this.initAudioContext();
                    // 页面加载时初始按钮淡入动画
                    setTimeout(() => {
                        document.getElementById('startBtn').classList.add('fade');
                        setTimeout(() => {
                            document.getElementById('startBtn').classList.remove('fade');
                        }, 1000);
                    }, 300);
                }

                // 处理按钮点击（保持原有逻辑，三段话依次显示）
                handleBtnClick() {
                    if (isCelebrating) return;
                    
                    const startBtn = document.getElementById('startBtn');
                    const meteor = document.getElementById('meteor');
                    
                    // 增加点击计数
                    clickCount++;
                    
                    // 第一次点击：切换到第二句文案 + 同步显示流星
                    if (clickCount === 1) {
                        startBtn.textContent = btnTexts[1];
                        startBtn.classList.add('fade');
                        meteor.classList.add('animate');
                        this.playMeteorSound();
                        
                        setTimeout(() => {
                            startBtn.classList.remove('fade');
                            meteor.classList.remove('animate');
                        }, 1500); // 与简化后的流星动画时长保持一致（1.5秒）
                    }
                    // 第二次点击：切换到第三句文案（无流星）
                    else if (clickCount === 2) {
                        startBtn.textContent = btnTexts[2];
                        startBtn.classList.add('fade');
                        setTimeout(() => {
                            startBtn.classList.remove('fade');
                        }, 1000);
                    }
                    // 第三次点击：开始倒计时
                    else if (clickCount === 3) {
                        startBtn.style.opacity = '0';
                        startBtn.style.pointerEvents = 'none';
                        setTimeout(() => {
                            startBtn.style.display = 'none';
                        }, 300);
                        
                        this.startCountdown();
                    }
                }

                // 启动倒计时
                startCountdown() {
                    const countdownEl = document.getElementById('countdown');
                    
                    let count = 3;
                    countdownEl.style.opacity = '1';
                    countdownEl.textContent = count;
                    
                    const countdownInterval = setInterval(() => {
                        count--;
                        if (count > 0) {
                            countdownEl.textContent = count;
                            this.playCountdownSound();
                        } else {
                            clearInterval(countdownInterval);
                            countdownEl.style.opacity = '0';
                            setTimeout(() => {
                                countdownEl.style.display = 'none';
                                this.animationActive = true;
                                this.scheduleNextFirework();
                                this.animateText();
                            }, 300);
                        }
                    }, 1000);
                }

                // 随机数生成
                random(min, max) {
                    return Math.random() * (max - min) + min;
                }

                // 洗牌算法
                shuffleArray(array) {
                    const newArray = [...array];
                    for (let i = newArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                    }
                    return newArray;
                }

                // 对象池获取粒子
                getParticle() {
                    let particle = this.particlePool.pop();
                    if (!particle) {
                        particle = document.createElement('div');
                        particle.className = 'particle particle-dot';
                        this.container.appendChild(particle);
                    }
                    particle.style.opacity = '1';
                    particle.style.transform = 'scale(1)';
                    return particle;
                }

                // 释放粒子到对象池
                releaseParticle(particle) {
                    particle.style.opacity = '0';
                    this.particlePool.push(particle);
                    
                    if (this.particlePool.length > 300) {
                        const extra = this.particlePool.splice(0, 100);
                        extra.forEach(p => p.remove());
                    }
                }

                // 创建烟花
                createFirework(x, y, targetX, targetY, color) {
                    if (!this.animationActive || this.activeFireworks >= this.MAX_FIREWORKS) return;
                    
                    this.activeFireworks++;
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.backgroundColor = color;
                    firework.style.left = `${x}px`;
                    firework.style.bottom = '0px';
                    this.container.appendChild(firework);

                    const distance = Math.sqrt(Math.pow(targetX - x, 2) + Math.pow(targetY, 2));
                    const duration = this.random(2.0, 3.0) * (distance / 500) * this.ascentSpeedFactor;

                    setTimeout(() => {
                        firework.style.opacity = '1';
                        firework.style.transform = 'scale(1)';

                        const animation = firework.animate([
                            { bottom: '0px', left: `${x}px` },
                            { bottom: `${targetY}px`, left: `${targetX}px` }
                        ], {
                            duration: duration * 1000,
                            easing: 'cubic-bezier(0.3, 0.1, 0.3, 1)'
                        });

                        animation.onfinish = () => {
                            this.activeFireworks--;
                            const explosionTypes = ['ring', 'pulse', 'star', 'heart'];
                            const explosionType = explosionTypes[Math.floor(Math.random() * explosionTypes.length)];
                            this.explodeFirework(targetX, targetY, color, explosionType);
                            firework.remove();
                        };
                    }, 50);
                }

                // 烟花爆炸
                explodeFirework(x, y, color, explosionType = 'ring') {
                    const config = this.explosionConfigs[explosionType];
                    
                    this.createExplosionFlash(x, y);
                    
                    switch (explosionType) {
                        case 'ring':
                            for (let i = 0; i < config.particleCount; i++) {
                                const angle = (i / config.particleCount) * (Math.PI * 2);
                                const particle = this.getParticle();
                                particle.style.backgroundColor = color;
                                particle.style.color = color;
                                particle.style.left = `${x}px`;
                                particle.style.bottom = `${y}px`;
                                
                                const vx = Math.cos(angle) * config.radius;
                                const vy = Math.sin(angle) * config.radius;
                                this.animateParticle(particle, x, y, vx, vy);
                            }
                            break;
                            
                        case 'pulse':
                            for (let j = 0; j < config.pulseCount; j++) {
                                setTimeout(() => {
                                    for (let i = 0; i < config.particleCount; i++) {
                                        const particle = this.getParticle();
                                        particle.style.backgroundColor = color;
                                        particle.style.color = color;
                                        particle.style.left = `${x}px`;
                                        particle.style.bottom = `${y}px`;
                                        
                                        const angle = this.random(0, Math.PI * 2);
                                        const distance = this.random(30, 150);
                                        const vx = Math.cos(angle) * distance;
                                        const vy = Math.sin(angle) * distance;
                                        this.animateParticle(particle, x, y, vx, vy);
                                    }
                                }, j * config.delay);
                            }
                            break;
                            
                        case 'star':
                            for (let i = 0; i < config.points * 2; i++) {
                                const radius = i % 2 === 0 ? config.radius : config.innerRadius;
                                const angle = (i / (config.points * 2)) * (Math.PI * 2);
                                const particle = this.getParticle();
                                particle.style.backgroundColor = color;
                                particle.style.color = color;
                                particle.style.left = `${x}px`;
                                particle.style.bottom = `${y}px`;
                                
                                const vx = Math.cos(angle) * radius;
                                const vy = Math.sin(angle) * radius;
                                this.animateParticle(particle, x, y, vx, vy);
                            }
                            
                            for (let i = 0; i < config.extraParticles; i++) {
                                const angle = this.random(0, Math.PI * 2);
                                const radius = this.random(30, config.radius);
                                const particle = this.getParticle();
                                particle.style.backgroundColor = color;
                                particle.style.color = color;
                                particle.style.left = `${x}px`;
                                particle.style.bottom = `${y}px`;
                                
                                const vx = Math.cos(angle) * radius;
                                const vy = Math.sin(angle) * radius;
                                this.animateParticle(particle, x, y, vx, vy);
                            }
                            break;
                            
                        case 'heart':
                            for (let i = 0; i < config.particleCount; i++) {
                                const t = (i / config.particleCount) * Math.PI * 2;
                                const xCoord = 16 * Math.pow(Math.sin(t), 3);
                                const yCoord = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) + 2;
                                
                                const vx = xCoord * config.scale * config.speed;
                                const vy = -yCoord * config.scale * config.speed + config.centerOffset;
                                
                                const particle = this.getParticle();
                                particle.style.backgroundColor = color;
                                particle.style.color = color;
                                particle.style.left = `${x}px`;
                                particle.style.bottom = `${y}px`;
                                
                                this.animateParticle(particle, x, y, vx, vy, { 
                                    duration: this.random(2.8, 3.8) * 1000 * this.particleLifetimeFactor 
                                });
                            }
                            break;
                    }

                    this.playFireworkSound();
                }

                // 创建爆炸闪光
                createExplosionFlash(x, y) {
                    const flash = document.createElement('div');
                    flash.className = 'explosion-flash';
                    flash.style.left = `${x - 6}px`;
                    flash.style.bottom = `${y - 6}px`;
                    this.container.appendChild(flash);
                    
                    flash.animate([
                        { opacity: 0.6, transform: 'scale(0.5)' },
                        { opacity: 0.3, transform: 'scale(1.5)' },
                        { opacity: 0, transform: 'scale(2)' }
                    ], {
                        duration: 700,
                        easing: 'ease-out'
                    }).onfinish = () => flash.remove();
                }

                // 粒子动画
                animateParticle(particle, x, y, vx, vy, options = {}) {
                    const gravityEffect = this.random(0, 8);
                    const duration = options.duration || 
                        this.random(1.5, 2.2) * 1000 * this.particleLifetimeFactor;
                    
                    const animation = particle.animate([
                        {
                            left: `${x}px`,
                            bottom: `${y}px`,
                            opacity: 1,
                            transform: `scale(1)`
                        },
                        {
                            left: `${x + vx}px`,
                            bottom: `${y + vy - gravityEffect}px`,
                            opacity: 0.9,
                            transform: `scale(0.9)`
                        },
                        {
                            left: `${x + vx * 1.1}px`,
                            bottom: `${y + vy * 1.1 - gravityEffect * 2}px`,
                            opacity: 0,
                            transform: `scale(0.5)`
                        }
                    ], {
                        duration: duration,
                        easing: 'cubic-bezier(0.2, 0.85, 0.2, 1)'
                    });

                    animation.onfinish = () => {
                        this.releaseParticle(particle);
                    };
                }

                // 播放烟花音效
                playFireworkSound() {
                    if (!this.audioContext) return;
                    
                    try {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();

                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(1000, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, this.audioContext.currentTime + 0.8);

                        gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.7, this.audioContext.currentTime + 0.05);
                        gainNode.gain.linearRampToValueAtTime(0, this.audioContext.currentTime + 0.8);

                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);

                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + 0.8);
                    } catch (error) {
                        console.warn('无法播放音效:', error);
                    }
                }

                // 播放倒计时音效
                playCountdownSound() {
                    if (!this.audioContext) return;
                    
                    try {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();

                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(400, this.audioContext.currentTime + 0.3);

                        gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.5, this.audioContext.currentTime + 0.05);
                        gainNode.gain.linearRampToValueAtTime(0, this.audioContext.currentTime + 0.3);

                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);

                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + 0.3);
                    } catch (error) {
                        console.warn('无法播放倒计时音效:', error);
                    }
                }

                // 播放流星音效（简化为纯白色对应的纯净音效）
                playMeteorSound() {
                    if (!this.audioContext) return;
                    
                    try {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();

                        oscillator.type = 'sine'; // 正弦波更纯净，匹配白色光晕
                        // 频率平缓下降，模拟纯净的划过声
                        oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, this.audioContext.currentTime + 1.5);

                        // 音量曲线简洁，无多余波动
                        gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.2, this.audioContext.currentTime + 0.2);
                        gainNode.gain.linearRampToValueAtTime(0, this.audioContext.currentTime + 1.5);

                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);

                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + 1.5);
                    } catch (error) {
                        console.warn('无法播放流星音效:', error);
                    }
                }

                // 初始化音频上下文
                initAudioContext() {
                    try {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (error) {
                        console.warn('音频上下文初始化失败:', error);
                        this.audioContext = null;
                    }
                }

                // 创建随机烟花
                createRandomFireworks() {
                    if (!this.animationActive || this.activeFireworks >= this.MAX_FIREWORKS) return;
                    
                    const fireworkCount = Math.floor(Math.random() * 2) + 1;
                    
                    for (let i = 0; i < fireworkCount; i++) {
                        const x = this.random(50, window.innerWidth - 50);
                        const targetY = this.random(window.innerHeight * 0.3, window.innerHeight * 0.6);
                        const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                        const startX = x + this.random(-50, 50);

                        setTimeout(() => {
                            this.createFirework(startX, 0, x, targetY, color);
                        }, i * 1000);
                    }
                }

                // 调度下一个烟花
                scheduleNextFirework() {
                    if (!this.animationActive) return;
                    
                    const delay = this.random(2000, 4000);
                    setTimeout(() => {
                        this.createRandomFireworks();
                        requestAnimationFrame(() => this.scheduleNextFirework());
                    }, delay);
                }

                // 文字动画
                animateText() {
                    if (!this.animationActive) return;
                    
                    const textElement = document.getElementById('birthdayText');
                    const lines = ["(◡ ‿ ◡ ✿)", "HAPPY_BIRTHDAY", "愿你心想事成"];
                    let totalDelay = 4;

                    textElement.innerHTML = '';
                    lines.forEach((lineText, lineIndex) => {
                        const lineElement = document.createElement('div');
                        lineElement.className = 'line';
                        textElement.appendChild(lineElement);

                        const shuffledChars = this.shuffleArray(
                            lineText.split('').map((char, index) => ({ char, index }))
                        );

                        const placeholders = [];
                        for (let i = 0; i < lineText.length; i++) {
                            const placeholder = document.createElement('span');
                            placeholder.className = 'letter';
                            placeholder.textContent = ' ';
                            lineElement.appendChild(placeholder);
                            placeholders.push(placeholder);
                        }

                        let lineDelay = 0;
                        shuffledChars.forEach((item, i) => {
                            const letter = document.createElement('span');
                            letter.className = 'letter';
                            letter.textContent = item.char;
                            const randomColor = this.colors[Math.floor(Math.random() * this.colors.length)];
                            letter.style.color = randomColor;
                            letter.style.textShadow = `0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px ${randomColor}40`;

                            const randomDelay = this.random(2, 3);
                            lineDelay += randomDelay;
                            const totalLetterDelay = totalDelay + lineDelay + (lineIndex * 1.5);

                            setTimeout(() => {
                                letter.style.opacity = '1';
                                letter.style.transform = 'translateY(0)';
                            }, totalLetterDelay * 1000);

                            if (placeholders[item.index]) {
                                placeholders[item.index].replaceWith(letter);
                            } else {
                                lineElement.appendChild(letter);
                            }
                        });

                        totalDelay += lineDelay;
                    });

                    textElement.style.opacity = '1';
                }

                // 设置事件监听器
                setupEventListeners() {
                    this.container.addEventListener('click', (e) => {
                        if (!this.animationActive) return;
                        
                        const x = e.clientX;
                        const targetY = this.random(window.innerHeight * 0.3, window.innerHeight * 0.6);
                        const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                        const startX = x + this.random(-50, 50);
                        this.createFirework(startX, 0, x, targetY, color);
                    });

                    this.container.addEventListener('touchstart', (e) => {
                        if (!this.animationActive) return;
                        
                        e.preventDefault();
                        const touch = e.touches[0];
                        const x = touch.clientX;
                        const targetY = this.random(window.innerHeight * 0.3, window.innerHeight * 0.6);
                        const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                        const startX = x + this.random(-50, 50);
                        this.createFirework(startX, 0, x, targetY, color);
                    }, { passive: false });

                    window.addEventListener('resize', () => {
                        if (!this.animationActive) return;
                        
                        this.animationActive = false;
                        setTimeout(() => {
                            this.animationActive = true;
                            this.scheduleNextFirework();
                        }, 500);
                    });
                }
            }

            // 初始化烟花管理器
            const fireworkManager = new FireworkManager('fireworksContainer');
            
            // 绑定开始按钮点击事件
            document.getElementById('startBtn').addEventListener('click', () => {
                if (fireworkManager.audioContext && fireworkManager.audioContext.state === 'suspended') {
                    fireworkManager.audioContext.resume();
                }
                fireworkManager.handleBtnClick();
            });
        });
    </script>
</body>
</html>









